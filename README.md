## 1 运行环境

​    本文件系统可运行于Linux系统和Windows系统下，模拟磁盘大小为256MB，请确保程序目录下有足够可用空间。

g++ 版本：9.2.0 (tdm64-1)

Linux下编译

```
cd WeiliangOS
make
```

Windows下编译

```
cd WeiliangOS
mingw32-make
```

## 2 启动方法

1. 打开WeiliangOS.exe
2. 输入help查看帮助
3. 输入login root登录root账号，初始密码为root

建议使用powershell启动项目，并设置编码为UTF-8，否则可能出现乱码

## 3 可用命令说明

### 3.1 未登录状态下可用命令

| **命令**  | **参数** | **功能** |
| --------- | -------- | -------- |
| **login** | <用户名> | 用户登录 |
| **help**  |          | 显示帮助 |
| **cls**   |          | 清屏     |
| **exit**  |          | 退出系统 |

### 3.2 登录状态下可用命令

| **命令**     | **参数**                         | **功能**                                       |
| ------------ | -------------------------------- | ---------------------------------------------- |
| **format**   |                                  | 格式化文件系统                                 |
| **mkdir**    | <目录名>                         | 创建目录                                       |
| **cd**       | <目录名>                         | 进入指定目录                                   |
| **ls**       |                                  | 显示当前目录清单                               |
| **rm**       | <文件名/目录名>                  | 删除文件或目录                                 |
| **touch**    | <文件名>                         | 创建新文件                                     |
| **cat**      | <文件名>                         | 打印文件内容                                   |
| **pwd**      |                                  | 打印当前路径                                   |
| **chmod**    | <文件名/目录名> <权限(OTC)>      | 更改目录或文件权限                             |
| **login**    | <用户名>                         | 用户登录                                       |
| **logout**   |                                  | 用户注销                                       |
| **adduser**  | <用户名><组名(可选)>             | 添加用户                                       |
| **deluser**  | <用户名>                         | 删除用户                                       |
| **su**       | <用户名>                         | 切换用户                                       |
| **df**       |                                  | 查看磁盘使用情况                               |
| **write**    | <文件名> <起始位置>              | 写入文件                                       |
| **win2wlos** | <Windows文件名> <文件系统文件名> | 将Windows文件内容导入到WeliliangOS文件系统文件 |
| **wlos2win** | <文件系统文件名> <Windows文件名> | 将WeliliangOS文件系统文件内容复制到Windows文件 |
| **help**     |                                  | 显示帮助                                       |
| **cls**      |                                  | 清屏                                           |
| **exit**     |                                  | 退出系统                                       |

## 4 注意事项

1. 退出程序时请使用exit命令退出，请勿直接关闭程序，这可能会导致析构函数不调用，文件操作无法保存导致文件系统错误或崩溃。
2. 谨慎修改 /etc/users.txt 和 /etc/groups.txt 两个文件，这两个文件与用户与组管理相关，修改不当可能会导致文件系统无法登录或其他权限问题。
3. 写入文件或从Windows导入文件时注意文件大小不要超过16518KB，这是巨型文件的最大大小，若超出该大小可能导致文件内容缺失或文件系统出错崩溃。

若遇到上述问题，请尝试使用format命令格式化文件系统或重写编译启动项目。

## 5 可调参数

这些参数位于FileSystem.h的宏定义中

| **参数**           | **说明**                |
| ------------------ | ----------------------- |
| **WLOS_DISK_NAME** | 磁盘名                  |
| **WLOS_DISK_SIZE** | 磁盘大小，至少大于512KB |

## 6 源文件说明

| **文件名**            | **说明**                   |
| --------------------- | -------------------------- |
| **Buf.h**             | 缓存块定义头文件           |
| **BufferManager.h**   | 缓存管理模块头文件         |
| **BufferManager.cpp** | 缓存管理模块cpp文件        |
| **File.h**            | 文件控制块头文件定义       |
| **FileSystem.h**      | 文件系统模块头文件         |
| **FileSystem.cpp**    | 文件系统模块cpp文件        |
| **FileManager.h**     | 文件管理模块头文件         |
| **FileManager.cpp**   | 文件管理模块cpp文件        |
| **INode.h**           | Inode和DiskInode定义头文件 |
| **OSui.h**            | 命令行界面模块头文件       |
| **OSui.cpp**          | 命令行界面模块cpp文件      |
| **ToolFun.h**         | 工具函数头文件             |
| **ToolFun.cpp**       | 工具函数cpp文件            |
| **test.cpp**          | 自动化测试文件             |

## 5.7 参考项目

https://github.com/lingbai-kong/file-system

https://github.com/ikarishinjieva/unixV6-code-analyze-chs